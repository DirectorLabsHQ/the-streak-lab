<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Streak Lab | NBA Prop Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .heat-high { background-color: #ef4444; color: white; border: 1px solid #7f1d1d; } 
        .heat-med { background-color: #f97316; color: white; border: 1px solid #7c2d12; } 
        .heat-low { background-color: #334155; color: #94a3b8; border: 1px solid #1e293b; }
        .tab-active { border-bottom: 4px solid #f97316; color: #f97316; }
        .star-active { color: #f97316; fill: #f97316; }
        .legend-badge { background: linear-gradient(45deg, #ffd700, #b8860b); color: black; font-weight: 900; }
        .team-badge { background-color: #1e293b; color: #64748b; border: 1px solid #334155; font-size: 9px; padding: 1px 4px; border-radius: 4px; font-weight: 800; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-900 text-white font-sans selection:bg-orange-500/30">

    <div class="max-w-6xl mx-auto py-10 px-4">
        <header class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
            <div>
                <h1 class="text-5xl font-black italic tracking-tighter text-white uppercase">THE STREAK <span class="text-orange-500 font-bold">LAB</span></h1>
                <p class="text-slate-400 mt-1 uppercase tracking-widest text-[10px] font-bold italic">Prop Intelligence for the Sharp Bettor</p>
            </div>
            <div id="last-update" class="text-[10px] font-mono text-slate-500 bg-slate-800/50 px-3 py-1 rounded border border-slate-700 uppercase tracking-widest font-bold"></div>
        </header>

        <div class="mb-8 flex flex-col md:flex-row gap-4 items-center justify-between bg-slate-800/50 p-4 rounded-xl border border-slate-700">
            <div class="relative w-full md:w-96">
                <input type="text" id="player-search" onkeyup="filterData()" placeholder="Search Athlete or Team..." 
                       class="w-full bg-slate-900 border border-slate-700 rounded-lg py-2 px-4 text-sm focus:outline-none focus:border-orange-500 transition-colors">
            </div>
            
            <div class="flex items-center gap-6">
                <label class="flex items-center cursor-pointer group">
                    <span class="text-[10px] font-black uppercase tracking-widest text-slate-500 mr-3">Sharp Only (70%+)</span>
                    <input type="checkbox" id="sharp-toggle" onchange="filterData()" class="w-4 h-4 accent-orange-500 rounded border-slate-700 bg-slate-900">
                </label>
                <button onclick="toggleFavoritesOnly()" id="fav-filter-btn" class="text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-orange-500 font-bold">‚≠ê Favorites</button>
            </div>
        </div>

        <div class="flex gap-6 mb-8 text-xs font-black uppercase tracking-tighter border-b border-slate-800 overflow-x-auto scrollbar-hide">
            <button onclick="updateView('pts_heat')" id="tab-pts_heat" class="pb-2 px-2 tab-active whitespace-nowrap">Points</button>
            <button onclick="updateView('reb_heat')" id="tab-reb_heat" class="pb-2 px-2 text-slate-500 whitespace-nowrap">Rebounds</button>
            <button onclick="updateView('ast_heat')" id="tab-ast_heat" class="pb-2 px-2 text-slate-500 whitespace-nowrap">Assists</button>
            <button onclick="updateView('tpm_heat')" id="tab-tpm_heat" class="pb-2 px-2 text-slate-500 whitespace-nowrap">3PM</button>
            <button onclick="updateView('ft_heat')" id="tab-ft_heat" class="pb-2 px-2 text-slate-500 whitespace-nowrap">Free Throws</button>
        </div>

        <div class="bg-slate-800 rounded-xl shadow-2xl border border-slate-700/50 overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-900/80 text-slate-500 uppercase text-[10px] font-black tracking-widest">
                    <tr>
                        <th class="px-6 py-4 w-12 text-center">Fav</th>
                        <th class="px-6 py-4">Player / Team</th>
                        <th class="px-6 py-4 text-center">L10 Hit Rate</th>
                        <th class="px-6 py-4">Last Game Summary</th>
                    </tr>
                </thead>
                <tbody id="grid-body" class="divide-y divide-slate-700/30 text-sm"></tbody>
            </table>
        </div>
    </div>

    <script>
        let playerData = [];
        let favorites = JSON.parse(localStorage.getItem('streakLabFavs')) || [];
        let currentMetric = 'pts_heat';
        let showFavsOnly = false;

        const legends = ["Stephen Curry", "LeBron James", "Kevin Durant", "Giannis Antetokounmpo", "Nikola Jokic", "Luka Doncic"];

        async function loadData() {
            try {
                const response = await fetch('streak_data.json');
                const json = await response.json();
                playerData = json.players || [];
                document.getElementById('last-update').innerText = `UPDATED: ${json.last_updated || 'N/A'}`;
                filterData();
            } catch (e) { console.error(e); }
        }

        function toggleFav(name) {
            favorites = favorites.includes(name) ? favorites.filter(f => f !== name) : [...favorites, name];
            localStorage.setItem('streakLabFavs', JSON.stringify(favorites));
            filterData();
        }

        function toggleFavoritesOnly() {
            showFavsOnly = !showFavsOnly;
            document.getElementById('fav-filter-btn').classList.toggle('text-orange-500', showFavsOnly);
            filterData();
        }

        function updateView(metric) {
            document.querySelectorAll('[id^="tab-"]').forEach(b => b.classList.remove('tab-active', 'text-white'));
            document.getElementById(`tab-${metric}`).classList.add('tab-active', 'text-white');
            currentMetric = metric;
            filterData();
        }

        function filterData() {
            const search = document.getElementById('player-search').value.toLowerCase();
            const sharp = document.getElementById('sharp-toggle').checked;
            const filtered = playerData.filter(p => {
                const nameStr = (p.name || p.display_name || "").toLowerCase();
                const matchesSearch = nameStr.includes(search);
                const matchesSharp = sharp ? (p[currentMetric] || 0) >= 70 : true;
                const matchesFav = showFavsOnly ? favorites.includes(p.name || p.display_name) : true;
                return matchesSearch && matchesSharp && matchesFav;
            });
            renderTable(filtered);
        }

        function renderTable(data) {
            const body = document.getElementById('grid-body');
            body.innerHTML = data.sort((a,b) => (b[currentMetric] || 0) - (a[currentMetric] || 0)).map(p => {
                const rawName = p.name || p.display_name || "Unknown";
                const score = p[currentMetric] || 0;
                
                // Smart Split: Look for 2-3 uppercase letters at the end
                const tokens = rawName.trim().split(/\s+/);
                const lastToken = tokens[tokens.length - 1];
                const isTeamCode = /^[A-Z]{2,3}$/.test(lastToken);
                
                // If we found a team code, use it. If not, team is empty string.
                const team = p.team_code || (isTeamCode ? tokens.pop() : "");
                const displayName = tokens.join(" ");

                const isLegend = legends.some(l => displayName.startsWith(l));
                
