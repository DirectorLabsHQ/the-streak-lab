<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streak Lab | Intelligence Dashboard</title>
    <style>
        :root { --bg: #0f172a; --card-bg: #1e293b; --text: #f8fafc; --accent: #38bdf8; --hot: #ef4444; --warm: #f97316; --cold: #64748b; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Tab Styling */
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; background: #334155; padding: 5px; border-radius: 10px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; color: #94a3b8; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: var(--accent); color: var(--bg); }

        /* Search & Info */
        .controls { margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        #searchBar { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #475569; background: var(--card-bg); color: white; box-sizing: border-box; }
        .timestamp { font-size: 0.8rem; color: var(--accent); }

        /* Table Styling */
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 12px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #334155; }
        th { background: #1e293b; font-size: 0.75rem; text-transform: uppercase; color: #94a3b8; }
        
        .rank { width: 40px; color: var(--accent); font-weight: bold; }
        .heat-pill { padding: 5px 10px; border-radius: 6px; font-weight: 800; font-size: 0.9rem; min-width: 50px; display: inline-block; text-align: center; }
        .last-game { font-size: 0.8rem; color: #94a3b8; }
        
        .gsw-highlight { border-left: 4px solid #fde047; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ”¥ Streak Lab Intelligence</h1>
    <div class="controls">
        <div id="update-time" class="timestamp">Syncing...</div>
        <input type="text" id="searchBar" placeholder="Find athlete or team..." onkeyup="filterAndRender()">
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('pts_heat', this)">POINTS</button>
        <button class="tab-btn" onclick="switchTab('reb_heat', this)">REBOUNDS</button>
        <button class="tab-btn" onclick="switchTab('ast_heat', this)">ASSISTS</button>
        <button class="tab-btn" onclick="switchTab('tpm_heat', this)">3PM</button>
    </div>

    <table id="labTable">
        <thead>
            <tr>
                <th class="rank">#</th>
                <th>Athlete</th>
                <th>Team</th>
                <th id="heat-col-label">HEAT %</th>
                <th>Last Game</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    let rawData = [];
    let currentStat = 'pts_heat';

    async function loadLabData() {
        const response = await fetch('streak_data.json');
        const data = await response.json();
        rawData = data.players;
        document.getElementById('update-time').innerText = `Last Updated: ${data.last_updated} | ${data.lab_notes.benchmarks}`;
        filterAndRender();
    }

    function switchTab(statKey, btn) {
        currentStat = statKey;
        // Update UI
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('heat-col-label').innerText = statKey.split('_')[0].toUpperCase() + ' HEAT';
        filterAndRender();
    }

    function filterAndRender() {
        const query = document.getElementById('searchBar').value.toLowerCase();
        
        // 1. Filter by Search
        let filtered = rawData.filter(p => 
            p.name.toLowerCase().includes(query) || 
            p.team_code.toLowerCase().includes(query)
        );

        // 2. Sort by current stat (Highest to Lowest)
        filtered.sort((a, b) => b[currentStat] - a[currentStat]);

        const body = document.getElementById('tableBody');
        body.innerHTML = filtered.map((p, index) => `
            <tr class="${p.team_code === 'GSW' ? 'gsw-highlight' : ''}">
                <td class="rank">${index + 1}</td>
                <td><strong>${p.name}</strong></td>
                <td><span style="opacity:0.7">${p.team_code}</span></td>
                <td>${renderPill(p[currentStat])}</td>
                <td class="last-game">${p.last_game}</td>
            </tr>
        `).join('');
    }

    function renderPill(val) {
        const color = val >= 80 ? '#ef4444' : (val >= 50 ? '#f97316' : '#475569');
        return `<span class="heat-pill" style="background:${color}">${val}%</span>`;
    }

    loadLabData();
</script>

</body>
</html>
